{% extends 'website/base.html' %}
{% block head_extra %}
  <style>
    body { background: linear-gradient(180deg, rgba(232,244,255,.6) 0%, rgba(255,255,255,1) 40%); }
    .compliance { width:min(100%, 760px); margin: 24px auto 60px; padding: 20px; }
    .compliance-brand { text-align:center; margin-top:48px; }
    .compliance-brand a {
      font-size: clamp(20px, 3vw, 30px);
      font-weight: 700;
      text-decoration: none;
      color: var(--ink-6);
    }
    .card { background:#fff; border:1px solid var(--ink-2); border-radius:16px; padding:20px; box-shadow:var(--shadow); }
    .meta { margin:0; padding:0; list-style:none; display:flex; flex-direction:column; gap:4px; margin-bottom:14px; }
    .meta span{ font-weight:600; }
    .field{ display:flex; flex-direction:column; gap:6px; margin-top:12px; }
    label{ font-weight:600; }
    input, textarea, select{ padding:12px 14px; border:1px solid var(--ink-2); border-radius:12px; font:inherit; }
    textarea{ resize:vertical; min-height:120px; }
    .actions{ display:flex; gap:12px; align-items:center; margin-top:18px; flex-wrap:wrap; }
  </style>
{% endblock %}

{% block content %}
<div class="compliance-brand">
  <a href="{% url 'website:index' %}">Stop My Spam</a>
</div>
<section class="compliance">
  <div class="card">
    <h1>Broker Confirmation</h1>
    <p>Please confirm how you are handling this consumer suppression request.</p>

    <ul class="meta">
      <li><span>Broker:</span> {% if status_record %}{{ status_record.broker.name }}{% elif compliance %}{{ compliance.broker.name }}{% endif %}</li>
      {% if status_record %}
        <li><span>Consumer:</span> {{ status_record.consumer.full_name }} ({{ status_record.consumer.primary_email }})</li>
        <li><span>Requested action:</span> {{ status_record.get_request_type_display }}</li>
        <li><span>Request sent:</span>
          {% if status_record.contacted_at %}
            {{ status_record.contacted_at|date:"F j, Y" }}
          {% else %}
            {{ status_record.created_at|date:"F j, Y" }}
          {% endif %}
        </li>
      {% else %}
        <li><span>Requested action:</span> Stop My Spam suppression (daily CSV)</li>
        <li><span>Request sent:</span>
          {% if compliance and compliance.first_sent_at %}
            {{ compliance.first_sent_at|date:"F j, Y" }}
          {% else %}
            Pending outreach
          {% endif %}
        </li>
        <li><span>Records included:</span>
          {% if compliance and compliance.last_request_count %}
            {{ compliance.last_request_count }} consumer{{ compliance.last_request_count|pluralize }}
            {% if compliance.last_export_filename %} ({{ compliance.last_export_filename }}){% endif %}
          {% else %}
            Not available
          {% endif %}
        </li>
      {% endif %}
    </ul>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="t" value="{{ token }}">
      <div class="field">
        <label for="response_status">Current status</label>
        <select id="response_status" name="response_status" required>
          <option value="" disabled {% if not preselected_status %}selected{% endif %}>Select a status</option>
          {% for value,label in status_choices %}
            <option value="{{ value }}" {% if preselected_status == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="field">
        <label for="contact_name">Your name</label>
        <input id="contact_name" name="contact_name" type="text" placeholder="Jane Doe" value="{% if status_record %}{{ status_record.broker_contact_name }}{% elif compliance %}{{ compliance.contact_name }}{% endif %}">
      </div>
      <div class="field">
        <label for="contact_email">Your email</label>
        <input id="contact_email" name="contact_email" type="email" placeholder="you@company.com" value="{% if status_record %}{{ status_record.broker_contact_email }}{% elif compliance %}{{ compliance.contact_email }}{% endif %}">
      </div>
      <div class="field">
        <label for="notes">Notes (optional)</label>
        <textarea id="notes" name="notes" placeholder="Ticket numbers, remaining steps, or reasons">{% if status_record %}{{ status_record.notes }}{% elif compliance %}{{ compliance.notes }}{% endif %}</textarea>
      </div>
      <div class="actions">
        <button class="btn" type="submit">Submit response</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

